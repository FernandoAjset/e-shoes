@model LCDE.Models.ProductoFiltroDTO

@{
    Layout = "~/Views/Shared/_layoutEcommerce.cshtml";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-xl-3 col-lg-4 col-md-5">
            <!-- Categorías -->
            <div class="sidebar-categories">
                <div class="head-primary">Categorías</div>
                <ul class="main-categories">
                    @foreach (var item in Model.Categorias)
                    {
                        <li class="main-nav-list">
                            <a href="#" class="category-link" data-category-id="@item.Id">
                                <span class="lnr lnr-arrow-right"></span>
                                @item.Nombre
                            </a>
                        </li>
                    }
                </ul>
            </div>

            <!-- Rango de Precio -->
            <div class="sidebar-filter mt-50">
                <div class="top-filter-head">Filtros</div>
                <div class="common-filter">
                    <div class="head">Rango de precio</div>
                    <div class="price-range-area">
                        <div id="price-range"></div>
                        <div class="value-wrapper d-flex">
                            <div class="price">Precio:</div>
                            <span>Q</span>
                            <div id="lower-value"></div>
                            <div class="to">a</div>
                            <span>Q</span>
                            <div id="upper-value"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-9 col-lg-8 col-md-7">
            <!-- Barra de Búsqueda -->
            <div class="mb-4">
                <div class="input-group">
                    <input type="text" id="NombreProducto" name="NombreProducto" class="form-control" placeholder="Buscar producto..." />
                </div>
            </div>

            <!-- Lista de Productos -->
            <section id="product-list" class="lattest-product-area pb-40 category-list">
                <div class="row">
                    @foreach (var item in Model.productosListarDTO)
                    {
                        <!-- Producto Individual -->
                        <div class="col-lg-4 col-md-6">
                            <div class="single-product">
                                <img class="img-fluid" src="@item.Image_url" alt="">
                                <div class="product-details">
                                    <h6>@item.Nombre</h6>
                                    <div class="price">
                                        <h6>Q.@item.PrecioUnidad</h6>
                                    </div>
                                    <div class="prd-bottom">
                                        <a href="#" class="social-info" onclick="openAddToCartModal(@item.Id, @item.Existencia)">
                                            <span class="ti-bag"></span>
                                            <p class="hover-text">Agregar</p>
                                        </a>
                                        <a asp-action="DetalleProducto" asp-route-productoId="@item.Id"
                                           class="social-info">
                                            <span class="lnr lnr-move"></span>
                                            <p class="hover-text">Ver</p>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </section>
        </div>
    </div>
</div>

<!-- Modal para ingresar la cantidad -->
<div class="modal fade" id="addToCartModal" tabindex="-1" aria-labelledby="addToCartModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addToCartModalLabel">Agregar al Carrito</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label for="modalQuantity"><b>Cantidad:</b></label>
                <input type="number" id="modalQuantity" class="form-control" min="1" />
                <input type="hidden" id="modalProductId" />
                <input type="hidden" id="modalMaxQuantity" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="confirmAddToCart()">Agregar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/cart.js"></script>
    <script>
        function openAddToCartModal(productId, maxQuantity) {
            $('#modalProductId').val(productId);
            $('#modalMaxQuantity').val(maxQuantity);
            $('#modalQuantity').attr('max', maxQuantity);
            $('#modalQuantity').val(1);
            $('#addToCartModal').modal('show');
        }

        function confirmAddToCart() {
            var productId = $('#modalProductId').val();
            var quantity = $('#modalQuantity').val();
            var maxQuantity = $('#modalMaxQuantity').val();

            if (quantity <= 0 || quantity > maxQuantity) {
                showToast('error', 'Por favor, ingrese una cantidad válida.');
                return;
            }

            addToCart(productId, quantity);
            $('#addToCartModal').modal('hide');
        }
    </script>
}